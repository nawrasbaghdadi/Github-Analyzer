<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <title>Document</title>
    <link rel="stylesheet" href="style.css" />
</head>
<body>
    <header>
       <p> Github Analyzer </p>
       <em>Ananlyizes Github public repositories</em>
    </header>
    <div class="container">
        <p> A web application that analyses GitHub repositories , Please login with your github</p>
        <a id="github" href="https://github.com/login/oauth/authorize?client_id=c1e92e7deb88faf833bb" class="singin"> Github login</a>
    </div> 
    <div class="container">
            <div class="card search">
                <div class="header">
                    <h3> <strong>Anaalyze</strong> Form
                            <small>Please enter repositry and owner to analyses</small>
                    </h3>
                        
                </div>
                
                    <div class="form">
                      <form>
                        <input type="text" placeholder="owner"/>
                        <input type="text" placeholder="repositories"/>
                        <button>Analyze now...</button>
                      </form>
                    </div>
                  </div>
    </div>
    <div class="container">
        <div class="card">
                <div class="header">
                        <h3> <strong>Anaalyze</strong> History
                                <small>Please enter repositry and owner to analyses</small>
                        </h3>
                            
                    </div>
            <table>
                    <thead>
                    <tr>
                      <th>URL</th>
                      <th>Number OF Commits</th>
                      <th>number pull requests</th>
                      <th>README</th>
                    </tr>
                </thead>
                <tbody>
                    <tr>
                      <td>1</td>
                      <td>2</td>
                      <td>3</td>
                      <td>4</td>
                    </tr>
                    <tr>
                      <td></td>
                      <td></td>
                      <td></td>
                      <td></td>
                    </tr>
                    <tr>
                      <td></td>
                      <td></td>
                      <td></td>
                      <td></td>
                    </tr>
                    <tr>
                      <td></td>
                      <td></td>
                      <td></td>
                      <td></td>
                    </tr>
                    <tr>
                      <td></td>
                      <td></td>
                      <td></td>
                      <td></td>
                    </tr>
                </tbody>
                  </table>
                </div>
    </div>            
    <script>
    var ele = document.getElementById('github');
    //https://github.com/login/oauth/authorize?scope=user:email&client_id
  /*  $.getJSON('http://localhost:9999/authenticate/', function(data) {
     console.log(data.token);
   })*/
   
   
    if(window.location.href.match(/\?code=(.*)/) === null &&  window.location.href.match(/\?access_token=(.*)/) === null){
       console.log('no code');
    //window.location.replace('https://github.com/login/oauth/authorize?client_id=c1e92e7deb88faf833bb');

   }
   var code = window.location.href.match(/\?code=(.*)/)[1] ;
   console.log('code',code);
   var acc_token =  fetch('http://localhost:9999/authenticate/'+code)
    .then(function(response) {
    return response.json();
  })
  .then(function(myJson) {

    console.log(JSON.stringify(myJson));
    return myJson.token;
  }).catch(error=> console.log('error:',error));
  acc_token.then(res =>{ res
  console.log('yess',res);
  //https://api.github.com/user?access_token=
  // https://api.github.com/search/repositories?q=tetris+language:assembly&sort=stars&order=desc
  //'https://api.github.com/search/repositories?access_token='+res+'&q=tetris+language:assembly&sort=stars&order=desc'
  //"https://api.github.com/repos/programble/tetrasm/comments{/number}"
  //'https://api.github.com/search/repositories?q=tetris+language:assembly&sort=stars&order=desc' no tocken 
  //https://api.github.com/repos/havivha/Nand2Tetris/commits
  // nubmer of comit https://api.github.com/repos/havivha/Nand2Tetris/contributors
  //https://api.github.com/search/repositories?q=tetris+user:havivha+repo:Nand2Tetris
  //"https://github.com/havivha/Nand2Tetris"get the repo and name should be public
    fetch('https://api.github.com/repos/havivha/Nand2Tetris',{
        headers: new Headers({
            //application/json
            //application/vnd.github[.version].param[+json]
            'Content-Type': 'application/json',
            'Authorization': 'token '+res
        })
    })
        .then(res => res.json())
        .then(res => console.log(res));
  });
  
  
   
    </script>
</body>
</html>